<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.august.rbac.mapper.ResMapper">

    <select id="findByCode" resultType="com.august.rbac.domain.Res">
        SELECT * FROM
        t_rbac_resource
        WHERE
        code = #{code}
    </select>
    <select id="findResourceByRoleUserId" resultType="com.august.rbac.domain.Res">
        SELECT
            trr.*
        FROM
            t_rbac_resource trr
        WHERE
            EXISTS (
                SELECT
                    ts.resource_id
                FROM
                    (
                        SELECT
                            trrrr.resource_id
                        FROM
                            t_rbac_role_resource_relation trrrr
                        WHERE
                            EXISTS ( SELECT trrur.role_id FROM t_rbac_user_role_relation trrur
                            WHERE trrur.user_id = #{userId}
                            AND trrur.role_id = trrrr.role_id )
                    ) ts
                    WHERE
                    ts.resource_id = trr.id
                )
    </select>
    <select id="findByResourceType" resultType="com.august.rbac.domain.Res">
        select * from
        t_rbac_resource
        where
        resource_type = #{resType}
    </select>
    <select id="findResourceByRoleUserIdAndType" resultType="com.august.rbac.domain.Res">
        SELECT
            trr.*
        FROM
            t_rbac_resource trr
        WHERE
            EXISTS (
            SELECT
                ts.resource_id
            FROM
                (
                SELECT
                    trrrr.resource_id
                FROM
                    t_rbac_role_resource_relation trrrr
                WHERE
                    EXISTS ( SELECT trrur.role_id FROM
                    t_rbac_user_role_relation trrur
                    WHERE
                    trrur.role_id = trrrr.role_id )
                    AND trrur.user_id = #{userId}
                ) ts
            WHERE
                ts.resource_id = trr.id
            )
            AND resource_type = #{resType}
    </select>
    <select id="findByRoleId" resultType="com.august.rbac.domain.Res">
      SELECT
        t.*
    FROM
        t_rbac_resource t
        JOIN t_rbac_role_resource_relation r ON t.id = r.resource_id
    WHERE
        r.role_id = #{roleId}
    </select>
    <select id="findByPid" resultType="com.august.rbac.domain.Res">
        select * from
        t_rbac_resource
        where
        pid = #{pid}
    </select>
</mapper>
